# פיצ'ר שיוך לקיבוצים - תיעוד

## סקירה כללית
פיצ'ר זה מאפשר ללקוחות להיות משויכים לקיבוצים ולקבל הנחות מיוחדות על הזמנותיהם. המנהל יכול לנהל קיבוצים, להגדיר אחוזי הנחה, ולעקוב אחר הזמנות לפי קיבוץ.

## תכונות עיקריות

### 1. שיוך לקיבוץ ללקוחות
- **כפתור בכותרת**: לקוחות רואים כפתור "שייך לקיבוץ" בצד ימין למעלה
- **מודל בחירה**: לחיצה על הכפתור פותחת מודל עם רשימת הקיבוצים הזמינים
- **הצטרפות**: לקוח יכול לבחור קיבוץ ולהצטרף אליו
- **עזיבה**: לקוח יכול לעזוב קיבוץ קיים

### 2. ניהול קיבוצים למנהל
- **טאב חדש**: "ניהול קיבוצים" בפאנל הניהול
- **הוספת קיבוץ**: אפשרות להוסיף קיבוץ חדש עם שם, תיאור ואחוז הנחה
- **עריכת קיבוץ**: עדכון פרטי קיבוץ קיים
- **מחיקת קיבוץ**: הסרת קיבוץ מהמערכת
- **הפעלה/השבתה**: אפשרות להפעיל או להשבית קיבוץ

### 3. הנחות אוטומטיות
- **חישוב הנחה**: חברי קיבוץ מקבלים הנחה אוטומטית על הזמנותיהם
- **תצוגת הנחה**: ההנחה מוצגת בחישוב העלות הכוללת
- **גמישות**: כל קיבוץ יכול לקבל אחוז הנחה שונה

### 4. מעקב הזמנות לפי קיבוץ
- **צפייה בהזמנות**: מנהל יכול לראות את כל ההזמנות של קיבוץ ספציפי
- **סטטיסטיקות**: תצוגת מספר הקיבוצים הפעילים וסה"כ קיבוצים
- **פירוט הזמנות**: רשימה מפורטת של כל ההזמנות עם פרטי הלקוח והמוצר

## מבנה הנתונים

### קולקציית Kibbutzim
```javascript
{
  id: "kibbutz_id",
  name: "שם הקיבוץ",
  description: "תיאור הקיבוץ",
  discountPercentage: 10, // אחוז הנחה
  isActive: true,
  createdAt: timestamp,
  updatedAt: timestamp
}
```

### עדכון קולקציית Users
```javascript
{
  // ... שדות קיימים
  kibbutzId: "kibbutz_id", // אופציונלי
  kibbutzName: "שם הקיבוץ" // אופציונלי
}
```

### עדכון הזמנות (claimedBy)
```javascript
{
  // ... שדות קיימים
  kibbutzId: "kibbutz_id", // אופציונלי
  kibbutzName: "שם הקיבוץ", // אופציונלי
  discountPercentage: 10 // אחוז הנחה שהוחל
}
```

## קבצים שנוצרו/עודכנו

### קבצים חדשים
- `src/services/kibbutz.js` - שירות ניהול קיבוצים
- `src/hooks/useKibbutz.js` - Hook לניהול קיבוצים
- `src/components/KibbutzModal.js` - מודל בחירת קיבוץ
- `src/components/KibbutzModal.css` - עיצוב המודל
- `src/components/AdminPage/AdminKibbutzManagement.js` - ניהול קיבוצים למנהל
- `src/components/AdminPage/AdminKibbutzManagement.css` - עיצוב ניהול קיבוצים
- `src/pages/KibbutzManagementPage.js` - דף ניהול קיבוצים

### קבצים שעודכנו
- `src/services/firestore.js` - הוספת קולקציית kibbutzim
- `src/services/breads.js` - תמיכה בהנחות קיבוצים בהזמנות
- `src/services/users.js` - תמיכה בשיוך לקיבוץ
- `src/hooks/useOrders.js` - חישוב הנחות וחישוב עלות כוללת
- `src/components/Header.js` - הוספת כפתור קיבוץ
- `src/components/Header.css` - עיצוב כפתור הקיבוץ
- `src/components/AdminPage/AdminNavigation.js` - הוספת טאב קיבוצים
- `src/App.js` - הוספת נתיב ניהול קיבוצים
- `src/i18n/locales/he.json` - תרגומים עבריים
- `src/i18n/locales/en.json` - תרגומים אנגליים
- `src/services/index.js` - ייצוא שירות הקיבוצים
- `src/hooks/index.js` - ייצוא Hook הקיבוצים

## זרימת עבודה

### לקוח חדש
1. לקוח נכנס לאתר ומתחבר
2. רואה כפתור "שייך לקיבוץ" בכותרת
3. לוחץ על הכפתור ופותח מודל בחירת קיבוץ
4. בוחר קיבוץ מהרשימה ומצטרף
5. כעת הוא חבר קיבוץ ומקבל הנחות

### מנהל מנהל קיבוצים
1. מנהל נכנס לפאנל הניהול
2. לוחץ על טאב "ניהול קיבוצים"
3. יכול להוסיף קיבוץ חדש, לערוך קיים, או למחוק
4. יכול לראות הזמנות לפי קיבוץ
5. יכול להגדיר אחוזי הנחה שונים לכל קיבוץ

### הזמנה עם הנחה
1. חבר קיבוץ מבצע הזמנה
2. המערכת מזהה שהוא חבר קיבוץ
3. מחשבת הנחה אוטומטית לפי אחוז הקיבוץ
4. מציגה את העלות הכוללת עם ההנחה
5. שומרת את פרטי ההנחה בהזמנה

## אבטחה ובדיקות

### בדיקות נדרשות
- [ ] בדיקת הצטרפות לקיבוץ
- [ ] בדיקת עזיבת קיבוץ
- [ ] בדיקת חישוב הנחות
- [ ] בדיקת ניהול קיבוצים למנהל
- [ ] בדיקת הצגת הזמנות לפי קיבוץ
- [ ] בדיקת הרשאות (רק מנהלים יכולים לנהל קיבוצים)

### נקודות חשובות
- רק מנהלים יכולים לגשת לטאב ניהול הקיבוצים
- לקוחות יכולים להיות חברים בקיבוץ אחד בלבד
- הנחות מחושבות אוטומטית ואינן ניתנות לעריכה ידנית
- כל שינוי בקיבוץ משפיע על הזמנות עתידיות בלבד

## תמיכה טכנית

### דרישות מערכת
- Firebase Firestore עם קולקציית kibbutzim
- React Context לתמיכה במצב קיבוץ
- Toast notifications להודעות למשתמש
- RTL/LTR support לעברית ואנגלית

### ביצועים
- טעינה מהירה של רשימת קיבוצים
- חישוב הנחות בזמן אמת
- עדכון אוטומטי של עלויות
- מעקב יעיל אחר הזמנות קיבוצים

## סיכום
פיצ'ר זה מוסיף שכבת ניהול מתקדמת למערכת ההזמנות, מאפשר הנחות מותאמות אישית, ומשפר את חוויית המשתמש עבור לקוחות קיבוציים. המערכת גמישה, מאובטחת, ותומכת בשפות מרובות.
